<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Verse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        :root {
            --red-primary: #8B0000; /* Darker Red */
            --red-accent: #DC143C;  /* Crimson Red */
            --dark-background: #1a1a1a;
            --light-text: #e0e0e0;
            --box-background: rgba(20, 0, 0, 0.85); /* Slightly transparent dark red */
            --input-background: rgba(0,0,0,0.4);
            --border-glow: rgba(255, 0, 0, 0.5);
        }
        body, html {
            font-family: 'Cinzel', serif; /* Primary display font */
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-background);
            background-image: url('https://images.unsplash.com/photo-1620216127117-64b584a2221b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80');
            background-size: cover;
            background-position: center;
            color: var(--light-text);
        }

        /* --- Global Box Styling (Login & Chat) --- */
        #login-container, #chat-container {
            width: 100%;
            height: 100%;
            display: flex; /* Default state for login */
            justify-content: center;
            align-items: center;
            padding: 15px;
            box-sizing: border-box;
        }
        #chat-container {
             display: none; /* Chat is hidden initially */
        }
        #login-box, #chat-box-wrapper {
            background-color: var(--box-background);
            border: 2px solid var(--red-primary);
            box-shadow: 0 0 25px var(--border-glow);
            border-radius: 12px;
            width: 95%;
            max-width: 500px;
            height: 95vh;
            max-height: 850px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        /* --- 1. Login Screen --- */
        #login-box {
            padding: 40px;
            text-align: center;
            justify-content: center;
        }
        #login-box h2 {
            margin-top: 0;
            color: var(--red-accent);
            text-shadow: 0 0 10px #FF0000;
            font-family: 'Bangers', cursive; /* Comic book title font */
            font-size: 2.5em;
            margin-bottom: 25px;
        }
        #login-box p { font-size: 0.9em; color: #ccc; margin-bottom: 25px; }
        .form-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--red-primary);
            background-color: var(--input-background);
            color: var(--light-text);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1.1em;
            text-align: center;
        }
        .form-input::placeholder { color: #aaa; }
        #login-button {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--red-accent);
            background-color: transparent;
            color: var(--red-accent);
            font-family: 'Bangers', cursive;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        #login-button:hover { background-color: var(--red-accent); color: white; box-shadow: 0 0 15px var(--red-accent); }
        #error-message { color: #FF6347; margin-top: 15px; min-height: 1em; font-size: 0.9em; }

        /* --- 2. Chat Screen --- */
        #chat-header {
            padding: 15px 20px;
            background-color: var(--red-primary);
            border-bottom: 2px solid var(--red-accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        #chat-header h3 { margin: 0; color: white; font-family: 'Bangers', cursive; font-size: 1.8em; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        #hide-button { padding: 8px 15px; border: 1px solid white; border-radius: 5px; cursor: pointer; background-color: rgba(255,255,255,0.1); color: white; font-family: 'Cinzel', serif; font-size: 0.9em; transition: background-color 0.2s; }
        #hide-button:hover { background-color: rgba(255,255,255,0.2); }
        #messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
            background-color: rgba(0,0,0,0.3);
        }
        .message { max-width: 70%; padding: 12px 18px; border-radius: 20px; margin-bottom: 10px; word-wrap: break-word; line-height: 1.4; font-family: sans-serif; font-size: 0.95em; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .sent { background-color: var(--red-accent); color: white; align-self: flex-end; border-bottom-right-radius: 5px; }
        .received { background-color: #333; color: var(--light-text); align-self: flex-start; border-bottom-left-radius: 5px; }
        .message img { max-width: 100%; border-radius: 8px; display: block; margin-top: 5px; }
        #chat-form { display: flex; padding: 15px; border-top: 1px solid var(--red-primary); background-color: var(--box-background); flex-shrink: 0; }
        #text-input { flex-grow: 1; border: 1px solid var(--red-primary); padding: 12px; border-radius: 25px; background-color: var(--input-background); color: var(--light-text); outline: none; font-size: 1em; font-family: sans-serif; }
        #text-input::placeholder { color: #aaa; }
        .chat-button { background: none; border: none; font-size: 26px; cursor: pointer; color: var(--red-accent); margin-left: 10px; padding: 5px; transition: transform 0.2s; }
        .chat-button:hover { transform: scale(1.1); }
        
        /* --- 3. Dummy Screen --- */
        #dummy-container {
            display: none; /* Hidden by default */
            width: 100%; height: 100%; position: relative;
        }
        #dummy-iframe { width: 100%; height: 100%; border: none; }
        #return-button {
            position: fixed; top: 15px; right: 15px; padding: 10px 18px; background-color: rgba(139,0,0, 0.7); color: white; border: 2px solid var(--red-accent); border-radius: 8px; cursor: pointer; z-index: 1000; font-family: 'Bangers', cursive; font-size: 1.1em; box-shadow: 0 0 10px var(--border-glow); transition: all 0.2s ease;
        }
        #return-button:hover { background-color: var(--red-accent); box-shadow: 0 0 15px var(--red-accent); }
    </style>
</head>
<body>

    <div id="login-container">
        <div id="login-box">
            <h2>Secret Verse</h2>
            <p>Enter a secret realm to connect.</p>
            <input type="text" id="room-name-input" class="form-input" placeholder="Secret Realm Name" required>
            <button id="login-button">Enter Verse</button>
            <p id="error-message"></p>
        </div>
    </div>

    <div id="chat-container">
        <div id="chat-box-wrapper"> 
            <div id="chat-header">
                <h3 id="room-name-display">Secret Realm</h3>
                <button id="hide-button">Hide</button>
            </div>
            <div id="messages"></div>
            <form id="chat-form">
                <input type="file" id="image-input" accept="image/*" style="display: none;">
                <button type="button" id="image-button" class="chat-button">ðŸ“Ž</button>
                <input id="text-input" autocomplete="off" placeholder="Send a message to the Verse..." />
                <button type="submit" id="send-button" class="chat-button">âž¤</button>
            </form>
        </div>
    </div>

    <div id="dummy-container">
        <iframe id="dummy-iframe" src=""></iframe>
        <button id="return-button">Return to Verse</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDBSYI400UmUfJHKpCMoxJRUolDY_xQhKI",
            authDomain: "mychatapp-c034a.firebaseapp.com",
            projectId: "mychatapp-c034a",
            storageBucket: "mychatapp-c034a.appspot.com", // Corrected storage bucket URL
            messagingSenderId: "942436741647",
            appId: "1:942436741647:web:5db4a18ec0c3d3fb54297a",
            measurementId: "G-MEXHFHP1SR"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        
        // --- DOM Elements ---
        const loginContainer = document.getElementById('login-container');
        const chatContainer = document.getElementById('chat-container');
        const dummyContainer = document.getElementById('dummy-container');
        
        const loginButton = document.getElementById('login-button');
        const roomNameInput = document.getElementById('room-name-input');
        const errorMessage = document.getElementById('error-message');

        const roomNameDisplay = document.getElementById('room-name-display');
        const hideButton = document.getElementById('hide-button');
        const messagesDiv = document.getElementById('messages');
        const chatForm = document.getElementById('chat-form');
        const textInput = document.getElementById('text-input');
        const imageButton = document.getElementById('image-button');
        const imageInput = document.getElementById('image-input');

        const dummyIframe = document.getElementById('dummy-iframe');
        const returnButton = document.getElementById('return-button');

        let messagesRef = null;
        const sessionId = Math.random().toString(36).substr(2, 9);
        
        // --- Screen Switching Logic ---
        function showScreen(screen) {
            if (screen === 'login') {
                loginContainer.style.display = 'flex';
                chatContainer.style.display = 'none';
                dummyContainer.style.display = 'none';
            } else if (screen === 'chat') {
                loginContainer.style.display = 'none';
                chatContainer.style.display = 'flex';
                dummyContainer.style.display = 'none';
            } else if (screen === 'dummy') {
                loginContainer.style.display = 'none';
                chatContainer.style.display = 'none';
                dummyContainer.style.display = 'block';
            }
        }
        
        // --- Login Logic ---
        loginButton.onclick = () => {
            const roomName = roomNameInput.value.trim();
            if (roomName) {
                startChat(roomName);
            } else {
                errorMessage.textContent = 'Please enter a Secret Realm Name.';
            }
        };
        
        function startChat(roomName) {
            roomNameDisplay.textContent = roomName;
            showScreen('chat');
            messagesRef = database.ref(`rooms/${roomName}/messages`);
            listenForMessages();
        }

        // --- Hide/Return Logic ---
        hideButton.onclick = () => {
            dummyIframe.src = "https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1";
            showScreen('dummy');
        };
        returnButton.onclick = () => showScreen('chat');

        // --- Chat Functionality ---
        chatForm.onsubmit = e => { e.preventDefault(); if (textInput.value) { sendMessage({ type: 'text', text: textInput.value }); textInput.value = ''; } };
        imageButton.onclick = () => imageInput.click();
        imageInput.onchange = e => {
            const file = e.target.files[0]; if (!file) return;
            const filePath = `images/${messagesRef.key}/${Date.now()}_${file.name}`;
            storage.ref(filePath).put(file).then(snapshot => snapshot.ref.getDownloadURL())
                .then(url => sendMessage({ type: 'image', imageUrl: url }));
            imageInput.value = '';
        };
        
        function sendMessage(messageData) {
            messagesRef.push({ ...messageData, sender: sessionId, timestamp: Date.now() });
        }

        function listenForMessages() {
            messagesDiv.innerHTML = '';
            messagesRef.orderByChild('timestamp').on('child_added', snapshot => {
                const msgData = snapshot.val();
                const msgElement = document.createElement('div');
                msgElement.classList.add('message');
                if (msgData.type === 'image') {
                    const img = document.createElement('img'); img.src = msgData.imageUrl; msgElement.appendChild(img);
                } else {
                    msgElement.textContent = msgData.text;
                }
                msgElement.classList.add(msgData.sender === sessionId ? 'sent' : 'received');
                messagesDiv.prepend(msgElement);
            });
        }

        // Initialize the view to the login screen when the page loads
        showScreen('login');
    </script>
</body>
</html>
